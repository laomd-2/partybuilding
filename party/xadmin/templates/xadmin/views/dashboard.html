{% extends base_template %}
{% load i18n xadmin_tags %}
{% load staticfiles %}

{% block bodyclass %}dashboard{% endblock %}
{% block breadcrumbs %}{% endblock %}

{% block nav_title %}
  {% if icon %}<i class="{{ icon }}"></i>{% endif %} {{ title }}
{% endblock %}

{% block nav_toggles %}
  {% include "xadmin/includes/toggle_menu.html" %}
  {% if has_add_widget_permission %}
    <a title="{% trans "Add Widget" %}" href="{{ add_widget_url }}" class="navbar-toggle pull-right">
      <i class="fa fa-plus"></i></a>
  {% endif %}
{% endblock %}

{% block nav_btns %}
  {% if has_add_widget_permission %}
    <a title="{% trans "Add Widget" %}" href="{{ add_widget_url }}" class="btn btn-primary">
      <i class="fa fa-plus"></i> <span>{% trans "Add Widget" %}</span></a>
  {% endif %}
{% endblock %}

{% block content %}
  {#<div class="dashboard row">#}
  {#  {% for c in columns %}#}
  {#  <div class="{{ c.0 }} column">#}
  {#    {% for widget in c.1 %}#}
  {#      {{ widget.widget|safe }}#}
  {#    {% endfor %}#}
  {#  </div>#}
  {#  {% endfor %}#}
  {#</div>#}
  {#  <div class="page">#}
  {#</div>#}
  {% if deffers %}
    {#    <div class="panel panel-default">#}
    {#        <div class="panel-heading"><i class="icon fa fa-chevron-up chevron"></i><h3 class="panel-title">未更新信息</h3></div>#}
    <div class="panel-group" id="accordion-deffer" style="margin-bottom: 2em">
      {% for phase, deffer in deffers.items %}
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion-deffer"
                 href="#deffer{{ forloop.counter0 }}"><span
                  class="badge">{{ deffer|length|add:"-1" }}</span>
                未及时接收的{{ phase }}
              </a>
            </h4>
          </div>
          <div id="deffer{{ forloop.counter0 }}" class="panel-collapse collapse">
            <div class="panel-body results table-responsive" style="overflow: auto">
              <h4>请注意更新动态信息，或者备注中说明原因，格式：{{ phase }}延迟发展-原因。</h4>
              <table class="table table-bordered table-striped table-hover">
                {% for row in deffer %}
                  {% if forloop.first %}
                    <thead>
                    <tr>
                      {% for c in row %}
                        <th style="text-align: center">{{ c }}</th>
                      {% endfor %}
                    </tr>
                    </thead>
                  {% else %}
                    {% if forloop.counter == 2 %}
                      <tbody>
                    {% endif %}
                  <tr>
                    {% for c in row %}
                      <td class="nowrap"
                          style="text-align: center; white-space: nowrap; {% if not c %} background-color: yellow{% endif %}">
                        {% if forloop.counter == 2 %}
                          <a href="info/member/{{ c }}/update">{{ c }}</a>
                        {% else %}
                          {{ c }}
                        {% endif %}
                      </td>
                    {% endfor %}
                  </tr>
                  {% if forloop.last %}
                    </tbody>
                  {% endif %}
                  {% endif %}
                {% endfor %}
              </table>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    {#    </div>#}
  {% endif %}

  {% if affairs %}
    {#    <div class="panel panel-default">#}
    {#        <div class="panel-heading"><i class="icon fa fa-chevron-up chevron"></i><h3 class="panel-title">党员发展计划</h3></div>#}
    <div class="panel-group" id="accordion">
      {% for affair in affairs %}
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion"
                 href="#collapse{{ affair.0 }}">
                点我展开。{{ affair.1 }}<span class="badge">{{ affair.2|length|add:"-1" }}</span>
              </a>
            </h4>
          </div>
          <div id="collapse{{ affair.0 }}" class="panel-collapse collapse">
            <div class="panel-body">
              <h4 style="display: inline; float: left">
                {{ affair.1 }}
              </h4>
              {% if can_send_email %}
                <form method="post" action="notice/email/{{ affair.0 }}">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-success"
                          style="display: inline; float: right;">
                    <i class="fa fa-send">发送邮件</i></button>
                </form>
              {% endif %}

              <form method="get" action="notice/{{ affair.0 }}">
                <button type="submit" class="btn btn-success"
                        style="display: inline; float: right; margin-right: 1em">
                  <i class="fa fa-download">下载表格</i></button>
              </form>

              {% if can_beian and affair.3 %}
                <form method="get" action="notice/beian/{{ affair.0 }}">
                  <button type="submit" class="btn btn-success"
                          style="display: inline; float: right; margin-right: 1em">
                    <i class="fa fa-download">{{ affair.3 }}</i></button>
                </form>
              {% endif %}

            </div>
            <div class="panel-body results table-responsive" style="overflow: auto">
              <table class="table table-bordered table-striped table-hover">
                {% for row in affair.2 %}
                  {% if forloop.first %}
                    <thead>
                    <tr>
                      {% for c in row %}
                        <th style="text-align: center">{{ c }}</th>
                      {% endfor %}
                    </tr>
                    </thead>
                  {% else %}
                    {% if forloop.counter == 2 %}
                      <tbody>
                    {% endif %}
                  <tr>
                    {% for c in row %}
                      <td class="nowrap"
                          style="text-align: center; white-space: nowrap; {% if not c %} background-color: yellow{% endif %}">
                        {% if forloop.counter == 2 %}
                          <a href="info/member/{{ c }}/update">{{ c }}</a>
                        {% else %}
                          {{ c }}
                        {% endif %}
                      </td>
                    {% endfor %}
                  </tr>
                  {% if forloop.last %}
                    </tbody>
                  {% endif %}
                  {% endif %}
                {% endfor %}
              </table>
            </div>

          </div>
        </div>
      {% endfor %}
    </div>
    {#    </div>#}
  {% endif %}

  <input type='hidden' id='_portal_key' value='{{ portal_key }}'/>
{% endblock %}